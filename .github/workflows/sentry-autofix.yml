name: Sentry auto-fix

on:
  repository_dispatch:
    types: [sentry_error]

  workflow_dispatch:
    inputs:
      sentry_payload:
        description: "Raw Sentry payload (JSON, optional)"
        required: false
        default: "{}"

jobs:
  handle-sentry-error:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Get Sentry payload
        id: payload
        run: |
          if [ -n "${{ github.event.client_payload.sentry }}" ]; then
            echo "Writing Sentry payload to sentry-event.json"
            cat << 'EOF' > sentry-event.json
          ${{ toJson(github.event.client_payload.sentry) }}
          EOF
          else
            echo "No payload found — manual trigger mode"
            echo '{}' > sentry-event.json
          fi

          echo "Sentry payload saved to sentry-event.json"
          cat sentry-event.json || true

      - name: Placeholder — Analyze payload
        run: |
          echo "Next step: parse sentry-event.json, detect error source, generate fix"
